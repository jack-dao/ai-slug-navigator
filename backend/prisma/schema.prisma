generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model School {
  id      Int      @id @default(autoincrement())
  name    String   @unique
  courses Course[]
}

model Course {
  id          Int       @id @default(autoincrement())
  code        String    // e.g. "CSE 101"
  name        String    // e.g. "Algorithms"
  credits     Int
  department  String
  
  // Note: This field gets overwritten if multiple profs teach the same course.
  // The real instructor info lives in 'Section'.
  instructor  String    

  schoolId    Int
  school      School    @relation(fields: [schoolId], references: [id])

  sections    Section[]

  @@unique([schoolId, code])
}

model Section {
  id            Int      @id @default(autoincrement())
  sectionCode   String   @unique // e.g. "CSE 101-01"
  
  courseId      Int
  course        Course   @relation(fields: [courseId], references: [id])

  sectionNumber String   
  sectionType   String   // "LEC", "LAB", etc.
  
  parentId      Int?     
  parent        Section?  @relation("LinkedSections", fields: [parentId], references: [id])
  subSections   Section[] @relation("LinkedSections")

  status        String   
  days          String   
  time          String
  startTime     String
  endTime       String
  location      String
  enrolled      Int
  capacity      Int
  instructor    String     
  professor     Professor? @relation(fields: [instructor], references: [name])
}

model Professor {
  id          String   @id @default(uuid())
  name        String   @unique
  
  rmpId       String?  // The weird ID RMP uses (e.g. "VGVhY2hlci0yMzM=")
  rating      Float?   
  difficulty  Float?   
  numRatings  Int?       
  reviews     Json?

  sections    Section[]
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   
  name      String
  createdAt DateTime @default(now())

  schedules Schedule[]
}

model Schedule {
  id        Int      @id @default(autoincrement())
  name      String   
  courses   Json     // Stores the list of selected class IDs
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}